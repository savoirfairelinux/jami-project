FROM debian:buster

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get clean
RUN apt-get update && \
    apt-get install -y -o Acquire::Retries=10 \
        devscripts \
        nodejs \
        vim \
        wget

# add/enable src repos (needed for next step)
RUN sed -n '/^deb\s/s//deb-src /p' /etc/apt/sources.list > /etc/apt/sources.list.d/deb-src.list

RUN apt-get clean && apt-get update
RUN mkdir /tmp/depsinst; \
    cd /tmp/depsinst; \
    if [ -z "${OVERRIDE_PACKAGING_DIR}" ]; then \
        cp -rp "/opt/ring-project-ro/packaging/rules/debian-qt" "debian"; \
    else \
        cp -rp "/opt/ring-project-ro/${OVERRIDE_PACKAGING_DIR}" "debian"; \
    fi; \
    mk-build-deps \
        --remove --install \
        --tool "apt-get -y --no-install-recommends -o Acquire::Retries=10" \
        "debian/control"

ADD scripts/build-package-debian-qt.sh /opt/build-package-debian-qt.sh

CMD /opt/build-package-debian-qt.sh
